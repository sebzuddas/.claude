The file /Users/sebastianozuddas/Programming/Website/simulator/src/app/abm/page.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   349â†’          onClose={() => setMessage(undefined)}
   350â†’        />
   351â†’      )}
   352â†’
   353â†’      {/* Simulation Canvas */}
   354â†’      <div className="w-full max-w-4xl">
   355â†’        <div className="bg-gray-900 rounded-lg overflow-hidden relative">
   356â†’          {/* Canvas Container */}
   357â†’          <div
   358â†’            ref={containerRef}
   359â†’            onClick={handleCanvasClick}
   360â†’            className="cursor-crosshair"
   361â†’            style={{ minHeight: 400 }}
   362â†’          />
   363â†’
   364â†’          {/* Controls Overlay */}
   365â†’          <div className="absolute bottom-4 left-4 right-4 flex flex-wrap gap-2 items-center bg-black/50 rounded-lg p-3">
   366â†’            {/* Playback */}
   367â†’            <button
   368â†’              onClick={simState?.paused ? handlePlay : handlePause}
   369â†’              className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium"
   370â†’            >
   371â†’              {simState?.paused ? 'â–¶ Play' : 'â¸ Pause'}
   372â†’            </button>
   373â†’            <button
   374â†’              onClick={handleStep}
   375â†’              className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md"
   376â†’              disabled={!simState?.paused}
   377â†’            >
   378â†’              Step
   379â†’            </button>
   380â†’            <button
   381â†’              onClick={handleReset}
   382â†’              className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md"
   383â†’            >
   384â†’              Reset
   385â†’            </button>
   386â†’
   387â†’            {/* Speed */}
   388â†’            <div className="flex items-center gap-2 ml-4">
   389â†’              <label className="text-white text-sm">Speed:</label>
   390â†’              <select
   391â†’                value={speed}
   392â†’                onChange={(e) => handleSpeedChange(parseFloat(e.target.value))}
   393â†’                className="px-2 py-1 rounded bg-gray-700 text-white text-sm"
   394â†’              >
   395â†’                <option value={0.5}>0.5x</option>
   396â†’                <option value={1}>1x</option>
   397â†’                <option value={2}>2x</option>
   398â†’              </select>
   399â†’            </div>
   400â†’
   401â†’            {/* Trails Toggle */}
   402â†’            <label className="flex items-center gap-2 ml-4 text-white text-sm cursor-pointer">
   403â†’              <input
   404â†’                type="checkbox"
   405â†’                checked={showTrails}
   406â†’                onChange={handleTrailsToggle}
   407â†’                className="rounded"
   408â†’              />
   409â†’              Trails
   410â†’            </label>
   411â†’
   412â†’            {/* Tick Counter */}
   413â†’            <div className="ml-auto text-white text-sm">
   414â†’              Tick: {simState?.tick || 0} | Seed: {simState?.seed || 0}
   415â†’            </div>
   416â†’          </div>
   417â†’        </div>
   418â†’
   419â†’        {/* Export Buttons */}
   420â†’        <div className="mt-4 flex gap-2">
   421â†’          <button
   422â†’            onClick={handleExportJSON}
   423â†’            className="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-sm"
   424â†’          >
   425â†’            ğŸ“„ Export JSON
   426â†’          </button>
   427â†’          <button
   428â†’            onClick={handleExportCSV}
   429â†’            className="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-sm"
   430â†’          >
   431â†’            ğŸ“Š Export CSV
   432â†’          </button>
   433â†’        </div>
   434â†’      </div>
   435â†’
   436â†’      {/* Entity Inspector (floating panel when entity selected) */}
   437â†’      {inspectedEntity && (
   438â†’        <div className="w-full max-w-4xl bg-white rounded-lg shadow-lg p-4 mt-4">
   439â†’          <div className="flex justify-between items-start">
   440â†’            <h3 className="font-semibold mb-2">Agent Inspector</h3>
   441â†’            <button
   442â†’              onClick={() => {
   443â†’                setInspectedEntity(null)
   444â†’                rendererRef.current?.setTrackedEntity(null)
   445â†’              }}
   446â†’              className="text-gray-400 hover:text-gray-600"
   447â†’            >
   448â†’              âœ•
   449â†’            </button>
   450â†’          </div>
   451â†’          <div className="text-sm grid grid-cols-2 md:grid-cols-4 gap-4">
   452â†’            <div><strong>ID:</strong> {inspectedEntity.id}</div>
   453â†’            <div><strong>Type:</strong> {inspectedEntity.archetype}</div>
   454â†’            {Object.entries(inspectedEntity.components).map(([type, data]) => (
   455â†’              <div key={type} className="col-span-2 md:col-span-1">
   456â†’                <div className="font-medium text-blue-600">{type}</div>
   457â†’                <pre className="text-xs bg-gray-100 p-2 rounded overflow-auto max-h-24">
   458â†’                  {JSON.stringify(data, null, 2)}
   459â†’                </pre>
   460â†’              </div>
   461â†’            ))}
   462â†’          </div>
   463â†’        </div>
   464â†’      )}
   465â†’
   466â†’      {/* Model Info */}
   467â†’      {model && (
   468â†’        <div className="w-full max-w-4xl bg-white rounded-lg shadow-lg p-4 mt-4">
   469â†’          <h3 className="font-semibold mb-2">Model Info</h3>
   470â†’          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
   471â†’            <div className="md:col-span-2">
   472â†’              <p className="text-gray-600">{model.overview.purpose}</p>
   473â†’            </div>
   474â†’            <div className="flex gap-4">
   475â†’              <div><strong>Agents:</strong> {controllerRef.current?.getEntities().length || 0}</div>
   476â†’              <div><strong>dt:</strong> {model.overview.scales.temporal.dt}</div>
   477â†’            </div>
   478â†’          </div>
   479â†’        </div>
   480â†’      )}
   481â†’
   482â†’      {/* Timeseries Plots - Two vertical graphs */}
   483â†’      <div className="w-full max-w-4xl mt-8 grid grid-cols-1 gap-4">
   484â†’        {/* Aggregate/Population-level Plot */}
   485â†’        <div className="bg-white rounded-lg shadow-lg p-4">
   486â†’          <h3 className="font-semibold mb-2">Population Dynamics (Aggregate)</h3>
   487â†’          <p className="text-xs text-gray-500 mb-2">Shows total counts and population-level metrics over time</p>
   488â†’          <div className="h-48 relative">
   489â†’            {timeseries.size > 0 ? (
   490â†’              <TimeseriesPlot data={timeseries} type="aggregate" />
   491â†’            ) : (
   492â†’              <div className="h-full flex items-center justify-center text-gray-400">
   493â†’                Run simulation to see population data
   494â†’              </div>
   495â†’            )}
   496â†’          </div>
   497â†’        </div>
   498â†’
   499â†’        {/* Individual Agent-level Plot */}
   500â†’        <div className="bg-white rounded-lg shadow-lg p-4">
   501â†’          <h3 className="font-semibold mb-2">Agent-Level Metrics (Individual)</h3>
   502â†’          <p className="text-xs text-gray-500 mb-2">Shows average values and distributions across individual agents</p>
   503â†’          <div className="h-48 relative">
   504â†’            {timeseries.size > 0 ? (
   505â†’              <TimeseriesPlot data={timeseries} type="individual" />
   506â†’            ) : (
   507â†’              <div className="h-full flex items-center justify-center text-gray-400">
   508â†’                Run simulation to see agent-level data
   509â†’              </div>
   510â†’            )}
   511â†’          </div>
   512â†’        </div>
   513â†’      </div>
   514â†’
   515â†’      {/* Instructions */}
   516â†’      <div className="w-full max-w-4xl bg-white rounded-lg shadow-lg p-4 mt-4">
   517â†’        <h3 className="font-semibold mb-2">Instructions</h3>
   518â†’        <ul className="text-sm text-gray-600 space-y-1 list-disc list-inside grid grid-cols-1 md:grid-cols-2">
   519â†’          <li>Select a demo or upload a custom JSON model</li>
   520â†’          <li>Click Play to start the simulation</li>
   521â†’          <li>Click on agents to inspect their state</li>
   522â†’          <li>Use Speed control to slow down or speed up</li>
   523â†’          <li>Enable Trails to see agent movement history</li>
   524â†’          <li>Export data as JSON or CSV for analysis</li>
   525â†’        </ul>
   526â†’      </div>
   527â†’
   528â†’      {/* Example JSON Format */}
   529â†’      <div className="w-full max-w-4xl mt-8">
   530â†’        <h3 className="text-lg font-semibold mb-4">Expected JSON Format:</h3>
   531â†’        <p className="text-sm text-gray-600 mb-3">
   532â†’          ABM models follow the ODD (Overview, Design concepts, Details) protocol structure.
   533â†’        </p>
   534â†’        <CodeBlock
   535â†’          code={{
   536â†’            "schemaVersion": "1.0",
   537â†’            "overview": {
   538â†’              "purpose": "Example flocking behavior simulation",
   539â†’              "entities": {
   540â†’                "componentTypes": [
   541â†’                  { "name": "Position", "properties": { "x": { "type": "number" }, "y": { "type": "number" } } },
   542â†’                  { "name": "Velocity", "properties": { "x": { "type": "number" }, "y": { "type": "number" } } }
   543â†’                ],
   544â†’                "archetypes": [
   545â†’                  {
   546â†’                    "name": "Boid",
   547â†’                    "components": {
   548â†’                      "Position": { "x": 0, "y": 0 },
   549â†’                      "Velocity": { "x": 0, "y": 0 }
   550â†’                    },
   551â†’                    "visual": { "shape": "triangle", "size": 8, "color": "#4285f4" }
   552â†’                  }
   553â†’                ]
   554â†’              },
   555â†’              "scales": {
   556â†’                "spatial": { "type": "continuous2D", "width": 800, "height": 600 },
   557â†’                "temporal": { "dt": 0.1 }
   558â†’              },
   559â†’              "processSchedule": [{ "system": "movement" }, { "system": "rules" }]
   560â†’            },
   561â†’            "designConcepts": {
   562â†’              "interaction": {
   563â†’                "rules": [
   564â†’                  {
   565â†’                    "name": "separation",
   566â†’                    "trigger": { "onProximity": { "radius": 25 } },
   567â†’                    "effect": { "increment": { "target": "self.Velocity.x", "amount": { "prop": "separation.x" } } }
   568â†’                  }
   569â†’                ]
   570â†’              },
   571â†’              "observation": {
   572â†’                "timeseries": [{ "name": "count", "query": { "count": {} } }]
   573â†’              }
   574â†’            },
   575â†’            "details": {
   576â†’              "initialization": {
   577â†’                "entities": [
   578â†’                  { "archetype": "Boid", "count": 50, "position": { "type": "random" } }
   579â†’                ]
   580â†’              }
   581â†’            }
   582â†’          }}
   583â†’        />
   584â†’        <div className="mt-6 p-4 bg-blue-50 rounded-lg">
   585â†’          <h4 className="font-semibold mb-2">Key Features:</h4>
   586â†’          <ul className="list-disc list-inside text-sm space-y-1">
   587â†’            <li><strong>overview</strong>: Entity types, archetypes, environment size, and process schedule</li>
   588â†’            <li><strong>designConcepts</strong>: Interaction rules with triggers (everyTick, onProximity, onEvent) and effects</li>
   589â†’            <li><strong>details</strong>: Initial entity spawning configuration</li>
   590â†’            <li>Rules use expression trees (no code) for conditions and effects</li>
   591â†’            <li>Supports steering behaviors: seek, flee, separation, alignment, cohesion, wander</li>
   592â†’          </ul>
   593â†’        </div>
   594â†’      </div>
   595â†’    </VisualizationLayout>
   596â†’  )
   597â†’}
   598â†’