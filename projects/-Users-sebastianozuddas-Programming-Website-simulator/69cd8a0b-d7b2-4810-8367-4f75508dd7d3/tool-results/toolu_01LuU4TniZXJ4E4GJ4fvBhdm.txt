    63→
    64→  // =============================================================================
    65→  // INITIALIZATION
    66→  // =============================================================================
    67→
    68→  const initializeSimulation = useCallback(async (modelDef: ABMModelDefinition) => {
    69→    if (!containerRef.current) return
    70→
    71→    try {
    72→      // Clean up existing simulation
    73→      if (animationFrameRef.current) {
    74→        cancelAnimationFrame(animationFrameRef.current)
    75→      }
    76→      if (rendererRef.current) {
    77→        rendererRef.current.destroy()
    78→      }
    79→
    80→      // Create controller
    81→      const controller = new SimulationController()
    82→      controllerRef.current = controller
    83→
    84→      // Initialize simulation
    85→      controller.initialize(modelDef)
    86→
    87→      // Get environment config
    88→      const envConfig = controller.getEnvironmentConfig()
    89→      if (!envConfig) throw new Error('No environment config')
    90→
    91→      // Create renderer
    92→      const renderer = new ABMRenderer({
    93→        width: envConfig.spatial.width,
    94→        height: envConfig.spatial.height,
    95→        showGrid: envConfig.spatial.type === 'grid2D',
    96→        showTrails: showTrails
    97→      })
    98→
    99→      await renderer.initialize(containerRef.current)
   100→      rendererRef.current = renderer
   101→
   102→      // Setup environment
   103→      renderer.setupEnvironment(
   104→        envConfig,
   105→        envConfig.features?.zones,
   106→        envConfig.features?.obstacles
   107→      )
   108→
   109→      // Set archetype visuals
   110→      const visuals = new Map<string, VisualConfig>()
   111→      for (const archetype of modelDef.overview.entities.archetypes) {
   112→        visuals.set(archetype.name, archetype.visual || {})
   113→      }
   114→      renderer.setArchetypeVisuals(visuals)
   115→
   116→      // Subscribe to controller events
   117→      controller.on('stateChanged', (state: unknown) => {
   118→        setSimState({ ...(state as SimulationState) })
   119→      })
   120→
   121→      controller.on('tick', () => {
   122→        setTimeseries(new Map(controller.getTimeseries()))
   123→      })
   124→
   125→      // Initial render
   126→      renderer.render(controller.getEntities())
   127→
   128→      setModel(modelDef)
   129→      setSimState(controller.getState())
   130→      setMessage({ text: `Loaded: ${modelDef.overview.purpose}`, type: 'success' })
   131→
   132→    } catch (error) {
   133→      console.error('Failed to initialize simulation:', error)
   134→      setMessage({
   135→        text: `Failed to initialize: ${error instanceof Error ? error.message : 'Unknown error'}`,
   136→        type: 'error'
   137→      })
   138→    }
   139→  }, [showTrails])
   140→
   141→  // Load demo on mount and when selection changes
   142→  useEffect(() => {
   143→    const demo = demoModels[selectedDemo]
   144→    if (demo) {
   145→      initializeSimulation(demo)
   146→    }
   147→    // eslint-disable-next-line react-hooks/exhaustive-deps
   148→  }, [selectedDemo])
   149→
   150→  // =============================================================================
   151→  // SIMULATION LOOP
   152→  // =============================================================================

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
