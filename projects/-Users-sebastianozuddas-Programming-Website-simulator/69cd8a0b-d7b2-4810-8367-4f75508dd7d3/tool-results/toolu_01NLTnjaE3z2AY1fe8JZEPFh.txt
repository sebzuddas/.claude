743-
744-    const sim = simulationRef.current
745-    const currentState = {
746-      time: sim.t[currentTimeIndex],
747-      states: sim.x[currentTimeIndex],
748-      inputs: sim.u[currentTimeIndex],
749-      outputs: sim.y[currentTimeIndex],
750-      labels: data.labels
751-    }
752-
753-    navigator.clipboard.writeText(JSON.stringify(currentState, null, 2))
754-      .then(() => alert('Current state copied to clipboard!'))
755-      .catch(err => console.error('Failed to copy:', err))
756-  }
757-
758:  const openInStateSpaceVisualizer = () => {
759-    if (!simulationRef.current || !data) {
760-      console.error('No simulation data available')
761-      return
762-    }
763-
764-    try {
765-      // Prepare data in StateSpaceData format
766-      const stateSpaceData = {
767-        t: simulationRef.current.t,
768-        x: simulationRef.current.x,
769-        labels: data.labels?.states,
770-        title: data.title || 'System Simulation'
771-      }
772-
773-      // Validate data before storing
--
784-    } catch (error) {
785-      console.error('Failed to open state space visualizer:', error)
786-    }
787-  }
788-
789-  return (
790-    <div className="w-full">
791-      <div ref={canvasRef} />
792-
793-      {/* Playback Controls */}
794-      <div ref={controlsRef} className="mt-4 p-4 bg-gray-100 rounded-lg">
795-        {/* Export Controls */}
796-        <div className="flex items-center justify-center gap-2 mb-4 pb-3 border-b border-gray-300">
797-          {hasSimulationData && (
798-            <button
799:              onClick={openInStateSpaceVisualizer}
800-              className="px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded hover:from-pink-600 hover:to-purple-600 transition-colors text-sm font-semibold shadow-md"
801-              title="Open this simulation in the State Space Visualizer"
802-            >
803-              ðŸŽ¨ View Phase Portrait
804-            </button>
805-          )}
806-          <button
807-            onClick={exportToCSV}
808-            className="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors text-sm"
809-            disabled={!hasSimulationData}
810-            title="Export time series data as CSV"
811-          >
812-            ðŸ“Š Export CSV
813-          </button>
814-          <button